<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Share Settings</title>
    <link rel="stylesheet" href="/settings.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>
    <div class="settings-container">
        <h1>MediaShare Settings</h1>

        <!-- Profile Picture Upload -->
        <div class="setting-item">
    <!-- ðŸ”¸ Removed image + label wrapper -->
    <span class="setting-label">Update Profile Picture</span> <!-- ðŸ”¹ Changed text -->

    <form th:action="@{/settings/updateProfilePic}" 
          method="post" 
          enctype="multipart/form-data" 
          class="profile-form">
        <!-- ðŸ”¸ Same input logic -->
        <input type="file" name="profilePic" id="profileUpload" accept="image/*" hidden onchange="this.form.submit()">
        <button type="button" class="change-btn" onclick="document.getElementById('profileUpload').click()">Change</button>
    </form>
</div>



<!-- Username Update -->
<div class="setting-item username-section">
    <span class="setting-label">Username</span>
    <div class="username-actions">
        <input type="text" id="usernameInput" placeholder="Enter new username" class="username-input">
        <button class="save-btn" onclick="saveUsername()">Update</button>
    </div>
</div>


        <div class="setting-item">
    <span class="setting-label">Saved</span>
    <a th:href="@{/saved/my}" class="link">View Saved</a>
</div>


        <div class="setting-item">
            <span class="setting-label">Story Archive Enabled</span>
            <label class="toggle">
                <input type="checkbox" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <span class="setting-label">Archive</span>
            <a href="#" class="link">View Archive</a>
        </div>

        <div class="setting-item">
            <span class="setting-label">Notifications Enabled</span>
            <label class="toggle">
                <input type="checkbox" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="setting-item">
  <span class="setting-label">Account Privacy</span>
  <div class="radio-group">
    <label>
  <input type="radio" name="privacy" value="PRIVATE"
         th:checked="${user.privacy == T(com.example.demo.model.User.Privacy).PRIVATE}"> Private
</label>
<label>
  <input type="radio" name="privacy" value="PUBLIC"
         th:checked="${user.privacy == T(com.example.demo.model.User.Privacy).PUBLIC}"> Public
</label>

  </div>
</div>


        <div class="setting-item">
            <span class="setting-label">Close Friends</span>
             <a th:href="@{'/following/' + ${user.user_id}}" class="link">Manage Close Friends</a>
        </div>

        <div class="setting-item">
            <span class="setting-label">Blocked Friends</span>
            <a href="#" class="link">Manage Blocked</a>
        </div>

        <div class="setting-item">
            <span class="setting-label">Allow Tags</span>
            <label class="toggle">
                <input type="checkbox" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="setting-item">
            <span class="setting-label">Theme</span>
            <div class="radio-group">
                <label>
                    <input type="radio" name="theme" checked> Light
                </label>
                <label>
                    <input type="radio" name="theme"> Dark
                </label>
            </div>
        </div>

        <button class="logout-btn">Log Out</button>
    </div>

    <!-- Bottom Navbar (Sidebar on larger screens) -->
<nav class="bottom-nav">
  <div class="nav-item" onclick="location.href='home.html'">
    <i class="fa-solid fa-house"></i>
    <span>Home</span>
  </div>
  <div class="nav-item" onclick="location.href='search.html'">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span>Search</span>
  </div>
  <div class="nav-item" onclick="location.href='create.html'">
    <i class="fa-solid fa-circle-plus"></i>
    <span>Create</span>
  </div>
  <div class="nav-item" onclick="location.href='chat.html'">
    <i class="fa-regular fa-comment"></i>
    <span>Messages</span>
  </div>
  <div class="nav-item" onclick="location.href='profile.html'">
    <i class="fa-regular fa-user"></i>
    <span>Profile</span>
  </div>
  <div class="nav-item more-btn">
    <i class="fa-solid fa-bars"></i>
    <span>More</span>
  </div>

  <!-- Popup menu -->
  <div class="menu-popup">
    <div class="menu-item" onclick="location.href='settings.html'">Settings</div>
    <div class="menu-item" onclick="location.href='activity.html'">Your activity</div>
    <div class="menu-item" onclick="location.href='saved.html'">Saved</div>
    <div class="menu-item">Switch appearance</div>
    <div class="menu-item" onclick="location.href='report.html'">Report a problem</div>
    <div class="menu-item" onclick="location.href='accounts.html'">Switch accounts</div>
    <div class="menu-item" onclick="location.href='logout.html'">Log out</div>
  </div>
</nav>



    <script>
        document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      const link = item.getAttribute('data-link');
      if (link) window.location.href = link;
    });
  });
        // Toggle and position popup menu for the "More" button
        const moreBtn = document.querySelector('.more-btn');
        const popup = document.querySelector('.menu-popup');
        const bottomNav = document.querySelectorAll('.bottom-nav i');

        // Toggle active class for bottom nav icons
        bottomNav.forEach(icon => {
            icon.addEventListener('click', (e) => {
                e.stopPropagation();
                if (!icon.classList.contains('more-btn')) {
                    bottomNav.forEach(i => i.classList.remove('active'));
                    icon.classList.add('active');
                }
            });
        });

        // Toggle popup menu
        moreBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            popup.classList.toggle('active');

            // Dynamically position popup to stay within viewport
            const rect = moreBtn.getBoundingClientRect();
            const isDesktop = window.innerWidth >= 1024;
            const popupHeight = popup.offsetHeight;
            const popupWidth = popup.offsetWidth;

            if (isDesktop) {
                // Sidebar mode: position to the right
                popup.style.left = '82px';
                popup.style.right = 'auto';
                popup.style.top = `${rect.top - popupHeight + 40}px`;
                popup.style.bottom = 'auto';
            } else {
                // Mobile mode: position above navbar
                popup.style.right = '10px';
                popup.style.left = 'auto';
                popup.style.bottom = `${window.innerHeight - rect.top + 10}px`;
                popup.style.top = 'auto';

                // Adjust if popup would go off-screen
                if (rect.right + popupWidth > window.innerWidth) {
                    popup.style.right = '5px';
                }
            }
        });

        // Close popup when clicking outside
        document.addEventListener('click', (e) => {
            if (!popup.contains(e.target) && !moreBtn.contains(e.target)) {
                popup.classList.remove('active');
            }
        });

document.querySelectorAll('input[name="privacy"]').forEach(radio => {
  radio.addEventListener('change', function() {
    const selected = this.value; // now directly PRIVATE or PUBLIC

    fetch('/settings/updatePrivacy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: `privacy=${selected}`
    })
    .then(res => res.text())
    .then(data => {
      if (data === 'SUCCESS') {
        alert(`Privacy updated to ${selected}`);
      } else {
        alert('Error updating privacy. Please try again.');
      }
    })
    .catch(err => console.error('Privacy update failed:', err));
  });
});

</script>

</body>
</html>